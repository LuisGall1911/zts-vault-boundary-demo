# Configure HCP Boundary

# Prerequisites

- Configure Auth0 users and group.
- Configure `AUTH0_API_TOKEN` in this workspace's variable for `auth0/auth0` terraform provider.
- Depending on Auth0 configuration, you may require to change `account.tf` and `auth.tf` files.

## Contents

- [Boundary operation example](#boundary-operation-example)
  - [Linux only](#linux-only)
  - [DB only](#db-only)
  - [Kubernetees](#kubernetes)
- [References]

# Boundary operation example

## Linux only

```bash
boundary authenticate oidc -auth-method-id=amoidc_xxxxxx
boundary connect ssh -target-id tssh_xxxxxx
```

## DB only

```bash
boundary authenticate oidc -auth-method-id=amoidc_xxxxxx
boundary connect postgres -target-id ttcp_xxxxxx -dbname demodb
```

SELECT operation is allowed, but INSERT operation is denied.

```sql
demodb=> \d
         List of relations
 Schema | Name  | Type  |  Owner
--------+-------+-------+----------
 public | stand | table | boundary
(1 row)
```
```sql
demodb=> insert into stand (id, name, stand) values (4, 'yoshikage', 'killer queen');
ERROR:  permission denied for table stand
```

## Kubernetes

Decode EKS's CA from output (`cluster_certificate_authority_data`).

```bash
base64 --decode <<< "..." > ca.crt
```

Connect k8s target with [Boundary Desktop](https://developer.hashicorp.com/boundary/tutorials/oss-getting-started/oss-getting-started-desktop-app).

Confirm PORT assigned to boundary local proxy and service account token generated through Vault.

Set environment varialbes. 

```bash
export PORT=
export REMOTE_USER_TOKEN= # refer to service account token generated by Vault
```

```bash
kubectl get pods --tls-server-name kubernetes --certificate-authority=ca.crt --server=https://127.0.0.1:$PORT --token=$REMOTE_USER_TOKEN
```

# References

- [OIDC Authentication](https://developer.hashicorp.com/boundary/tutorials/access-management/oidc-auth)
- [Manage OIDC IdP Groups](https://developer.hashicorp.com/boundary/tutorials/access-management/oidc-idp-groups)
- [JOJO Portal site](https://jojo-portal.com/en/about/sbr/)
  - **TIPS:** Boundary users are quoted from JOJO.